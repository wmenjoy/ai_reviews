# 阶段二：Sprint 详细计划（第3-4月）

**阶段目标**: 扩大覆盖范围，增强规则系统，完善多维度分析
**时间跨度**: 8周（4个Sprint）
**团队规模**: 6人（同阶段一）

---

## Sprint 5：多平台集成（第9-10周）

### Sprint 目标
GitHub Actions 深度集成，Git Hook 工具，扩大用户覆盖

### 故事点: 36 点

---

### 后端任务（16 点）

#### 1. GitHub Actions 集成（8 点）
**负责人**: 后端工程师1
**任务**:
- [ ] GitHub Actions Workflow 模板
  - 触发时机：pull_request, push
  - 调用 AI-Reviews API
  - 上传审查结果为 PR Comment
- [ ] GitHub App 开发（可选，更好的权限管理）
  - 注册 GitHub App
  - OAuth 认证流程
  - Webhook 接收
- [ ] GitHub Checks API 集成
  - 将审查结果显示为 Check Run
  - 支持 Required Checks（阻断合并）
- [ ] 状态徽章（Badge）
  - 生成代码质量徽章
  - 支持嵌入 README

**验收标准**:
- GitHub Actions 可以自动触发审查
- 审查结果显示为 Check Run
- 严重问题可以阻断 PR 合并

---

#### 2. Git Hook 工具（8 点）
**负责人**: 后端工程师2
**任务**:
- [ ] CLI 工具开发（Node.js / Go）
  - 命令：`ai-reviews init`（初始化 Hook）
  - 命令：`ai-reviews review`（手动审查）
  - 命令：`ai-reviews config`（配置）
- [ ] Pre-commit Hook
  - 审查暂存区代码
  - 快速模式（只检查高优先级规则）
  - 支持跳过（--no-verify）
- [ ] Pre-push Hook
  - 审查即将推送的 commits
  - 完整模式（全规则检查）
- [ ] 离线模式支持
  - 缓存规则库
  - 本地 AI 模型（Ollama，可选）

**验收标准**:
- CLI 工具可以安装和使用
- Pre-commit Hook 正常工作
- Pre-push Hook 正常工作

---

### 前端任务（8 点）

#### 3. GitHub 集成配置页面（4 点）
**负责人**: 前端工程师
**任务**:
- [ ] GitHub App 安装指引
  - 安装 GitHub App
  - 授权仓库
  - 自动同步仓库列表
- [ ] GitHub Actions 配置生成
  - 一键生成 Workflow 文件
  - 自定义触发条件
  - 下载配置文件
- [ ] Check Run 配置
  - 配置是否阻断合并
  - 配置最低通过分数

**验收标准**:
- 可以通过 UI 安装 GitHub App
- 可以生成 Workflow 配置

---

#### 4. CLI 工具文档页面（4 点）
**负责人**: 前端工程师
**任务**:
- [ ] CLI 工具使用指南
  - 安装步骤
  - 命令说明
  - 配置选项
- [ ] 交互式配置生成器
  - 在线生成 `.aireviews.yml` 配置
  - 下载配置文件

**验收标准**:
- 文档清晰易懂
- 配置生成器可用

---

### 推广任务（12 点）

#### 5. 扩大试点（12 点）
**负责人**: 产品经理
**任务**:
- [ ] 招募 10-15 个新团队
  - 不同技术栈
  - 不同团队规模
- [ ] 批量培训（2 场，每场 20 人）
- [ ] 自助接入优化
  - 简化接入流程
  - 提供接入检查清单
- [ ] 建立社区
  - 用户交流群
  - 定期答疑会（每周 1 次）
  - 案例分享（每 2 周 1 次）
- [ ] 收集反馈并优化

**验收标准**:
- 新增 10 个项目接入
- 培训覆盖 40+ 人
- 社区活跃度良好

---

### Sprint 5 验收标准（DoD）
- ✅ GitHub Actions 集成完成
- ✅ CLI 工具发布
- ✅ 新增 10 个项目接入
- ✅ 用户满意度 > 4.0

---

## Sprint 6：语言扩展和规则管理（第11-12周）

### Sprint 目标
支持 Java/Spring Boot 和 C 语言，规则管理系统上线

### 故事点: 42 点

---

### 后端任务（22 点）

#### 1. Java/Spring Boot 支持（8 点）
**负责人**: 后端工程师1
**任务**:
- [ ] Java 规则库（30 条）
  - 安全规则（10 条）：
    - SQL 注入、XSS、CSRF
    - 不安全的反序列化
    - 硬编码密钥
    - 权限绕过
    - 日志注入
  - 质量规则（12 条）：
    - 空指针检查
    - 资源未关闭
    - 异常处理不当
    - 命名规范
    - 代码复杂度
  - 性能规则（8 条）：
    - N+1 查询
    - 大事务
    - 不必要的对象创建
    - 字符串拼接
- [ ] Spring Boot 专项规则（10 条）
  - Bean 循环依赖
  - 事务注解使用不当
  - RestController 未做参数校验
  - 敏感配置泄漏
- [ ] Java 专用 Prompt

**验收标准**:
- 可以审查 Java/Spring Boot 代码
- 规则触发正常
- 准确率 > 80%

---

#### 2. C 语言支持（6 点）
**负责人**: 后端工程师2
**任务**:
- [ ] C 语言规则库（20 条）
  - 内存安全（8 条）：
    - 缓冲区溢出
    - 空指针解引用
    - 内存泄漏
    - 野指针
    - Double Free
    - Use After Free
  - 质量规则（8 条）：
    - 未检查返回值
    - 未初始化变量
    - 危险函数（strcpy, sprintf）
  - 并发安全（4 条）：
    - 数据竞争
    - 死锁风险
- [ ] C 语言专用 Prompt（强调内存安全）

**验收标准**:
- 可以审查 C 语言代码
- 内存安全问题检出率高

---

#### 3. 规则管理系统（8 点）
**负责人**: 后端工程师1 + 后端工程师2
**任务**:
- [ ] 规则 CRUD API
  - 创建自定义规则
  - 编辑规则
  - 删除规则
  - 启用/禁用规则
- [ ] 规则测试功能
  - 提供代码片段
  - 测试规则是否触发
  - 查看 AI 审查结果
- [ ] 规则效能分析
  - 统计每条规则的触发次数
  - 统计误报次数（用户标记）
  - 计算规则价值分（触发率 - 误报率）
- [ ] 规则版本管理
  - 规则修改历史
  - 回滚功能

**验收标准**:
- 可以创建和管理自定义规则
- 规则测试功能正常
- 规则效能数据准确

---

### 前端任务（12 点）

#### 4. 规则管理页面（12 点）
**负责人**: 前端工程师
**任务**:
- [ ] 规则库页面
  - 规则列表（分类、语言、框架）
  - 搜索和筛选
  - 规则详情（描述、Prompt、示例）
  - 启用/禁用开关
- [ ] 自定义规则编辑器
  - 表单：名称、描述、分类、语言
  - Prompt 编辑器（代码高亮）
  - 正则模式编辑（可选）
  - 严重级别选择
- [ ] 规则测试工具
  - 代码编辑器（Monaco Editor）
  - 一键测试
  - 显示测试结果
- [ ] 规则效能分析页面
  - 表格：规则名称、触发次数、误报次数、价值分
  - 排序功能
  - 导出报告
- [ ] 规则市场（预留，P2）
  - 社区规则浏览
  - 一键导入

**验收标准**:
- 可以浏览所有规则
- 可以创建和测试自定义规则
- 规则效能分析可查看

---

### AI 任务（8 点）

#### 5. 规则库扩展和优化（8 点）
**负责人**: AI 工程师
**任务**:
- [ ] 为每种语言编写高质量 Prompt
  - Java: 强调 Spring 生态
  - C: 强调内存安全
  - React: 强调性能和 Hooks
  - Go: 强调并发安全
  - Python: 强调代码简洁性
- [ ] 规则去重和合并
  - 识别重复规则
  - 合并相似规则
- [ ] Few-shot 示例库
  - 为每条规则准备 2-3 个示例
  - 正面示例（好的代码）
  - 负面示例（有问题的代码）
- [ ] Prompt 模板化
  - 提取公共模板
  - 支持变量替换

**验收标准**:
- 规则库包含 100+ 条规则
- 每条规则有 Few-shot 示例
- Prompt 质量提升

---

### Sprint 6 验收标准（DoD）
- ✅ 支持 Java/Spring Boot 和 C 语言
- ✅ 规则管理系统上线
- ✅ 规则库包含 100+ 条规则
- ✅ 新增 5 个项目接入

---

## Sprint 7：技术债务和多维度分析（第13-14周）

### Sprint 目标
技术债务管理上线，多维度分析（用户/部门/公司）

### 故事点: 40 点

---

### 后端任务（22 点）

#### 1. 基线管理（6 点）
**负责人**: 后端工程师1
**任务**:
- [ ] Baseline 数据模型
  - 关联 Service
  - 基线分支、Commit Hash
  - 质量分数、技术债务分数
  - 详细指标（JSON）
- [ ] 基线创建 API
  - 手动创建基线
  - 自动创建（每月/每季度）
- [ ] 基线对比功能
  - 当前代码 vs 基线
  - 识别新增问题
  - 识别修复的问题
- [ ] 基线管理 UI（前端）

**验收标准**:
- 可以创建和管理基线
- 可以区分新增和历史问题

---

#### 2. 技术债务追踪（8 点）
**负责人**: 后端工程师2
**任务**:
- [ ] TechDebt 数据模型
  - 债务总分计算
  - 按类别统计（security, quality, performance）
  - 按文件统计
  - 趋势分析（improving, stable, degrading）
- [ ] 技术债务聚合任务
  - 定时任务（每日）
  - 聚合最近审查结果
  - 更新债务分数
- [ ] 技术债务 API
  - 查询服务的技术债务
  - 查询债务详情
  - 查询债务趋势
- [ ] 债务修复计划（可选）
  - 自动生成修复优先级
  - 分配给负责人

**验收标准**:
- 可以查看每个服务的技术债务
- 债务趋势分析准确

---

#### 3. 多维度分析（8 点）
**负责人**: 后端工程师1 + 后端工程师2
**任务**:
- [ ] 数据快照模型
  - UserQualitySnapshot
  - DepartmentQualitySnapshot
  - CompanyQualitySnapshot
- [ ] 数据聚合任务（每日定时）
  - 聚合用户的审查数据
  - 聚合部门的审查数据
  - 聚合公司的审查数据
- [ ] 多维度分析 API
  - **用户视角**:
    - 个人质量画像
    - 我的项目列表
    - 我的审查历史
    - 我的问题统计
  - **部门视角**:
    - 部门质量看板
    - 成员质量排名
    - 部门问题分布
  - **公司视角**:
    - 全局质量看板
    - 部门对比
    - 年度目标追踪
- [ ] Redis 缓存优化（1 小时 TTL）

**验收标准**:
- 多维度 API 正常
- 数据聚合任务稳定运行
- 缓存命中率高

---

### 前端任务（14 点）

#### 4. 技术债务看板（6 点）
**负责人**: 前端工程师
**任务**:
- [ ] 技术债务概览页
  - 债务总分卡片
  - 债务分类饼图
  - 债务趋势折线图（近 30 天）
- [ ] 债务详情列表
  - 按文件分组
  - 显示问题数量和严重程度
  - 点击查看具体问题
- [ ] 基线管理页面
  - 基线列表
  - 创建基线按钮
  - 基线对比视图
- [ ] 修复计划（可选）
  - 问题优先级排序
  - 分配给负责人
  - 跟踪修复进度

**验收标准**:
- 技术债务看板直观易懂
- 基线管理功能完整

---

#### 5. 多维度分析页面（8 点）
**负责人**: 前端工程师
**任务**:
- [ ] 个人质量画像页
  - 个人得分卡片
  - 审查历史趋势图
  - 我的项目列表
  - 常见问题类型分析
- [ ] 部门质量看板
  - 部门整体得分
  - 成员质量排名表
  - 部门问题分布图
  - 导出部门报告
- [ ] 公司质量看板
  - 公司整体得分卡片
  - 部门对比柱状图
  - 目标追踪进度条
  - 趋势分析图表
- [ ] 权限控制
  - 用户只能查看自己的数据
  - 部门管理员可查看部门数据
  - 公司管理员可查看全部数据

**验收标准**:
- 三个维度的看板都可访问
- 权限控制正确
- 图表美观

---

### 测试任务（4 点）

#### 6. 数据准确性测试（4 点）
**负责人**: 全团队
**任务**:
- [ ] 验证数据聚合准确性
  - 手动计算 vs 系统计算
  - 边界情况测试
- [ ] 性能测试
  - 大数据量聚合（1000+ 审查记录）
  - 查询响应时间 < 1s
- [ ] 权限测试
  - 越权访问测试
  - 数据泄漏测试

**验收标准**:
- 数据聚合准确无误
- 查询性能良好
- 无权限漏洞

---

### Sprint 7 验收标准（DoD）
- ✅ 技术债务管理上线
- ✅ 多维度分析上线
- ✅ 基线管理可用
- ✅ 数据准确性 100%

---

## Sprint 8：权限系统和推广（第15-16周）

### Sprint 目标
完善权限系统，扩大推广，达到 20 个项目接入

### 故事点: 36 点

---

### 后端任务（14 点）

#### 1. 多租户和权限系统（14 点）
**负责人**: 后端工程师1 + 后端工程师2
**任务**:
- [ ] 组织架构管理
  - Organization CRUD
  - Department CRUD
  - User CRUD
  - 组织架构树
- [ ] RBAC 权限系统
  - 角色定义：
    - SUPER_ADMIN（平台管理员）
    - ORG_ADMIN（公司管理员）
    - DEPT_ADMIN（部门管理员）
    - DEVELOPER（开发者）
    - VIEWER（只读用户）
  - 权限定义：
    - 服务管理（创建、编辑、删除）
    - 规则管理（创建、编辑）
    - 用户管理（添加、删除）
    - 数据查看（个人/部门/公司）
  - 权限检查中间件
- [ ] 数据隔离
  - 按 Organization 隔离
  - 按 Department 隔离（可选）
  - Row Level Security（PostgreSQL）
- [ ] 审计日志
  - 记录所有敏感操作
  - 操作人、时间、动作、资源
  - 日志查询 API

**验收标准**:
- 权限系统正常工作
- 数据隔离有效
- 审计日志完整

---

### 前端任务（10 点）

#### 2. 组织架构管理页面（6 点）
**负责人**: 前端工程师
**任务**:
- [ ] 组织架构树
  - 树形结构展示
  - 拖拽调整（可选）
- [ ] 部门管理
  - 添加/编辑/删除部门
  - 配置部门管理员
- [ ] 用户管理
  - 用户列表
  - 添加用户
  - 分配角色
  - 分配部门
  - 禁用/启用用户
- [ ] 角色管理（可选）
  - 自定义角色
  - 配置权限

**验收标准**:
- 可以管理组织架构
- 可以管理用户和角色

---

#### 3. 审计日志页面（4 点）
**负责人**: 前端工程师
**任务**:
- [ ] 审计日志列表
  - 表格展示
  - 筛选：按用户、按动作、按时间
  - 搜索：按资源
- [ ] 日志详情
  - 显示完整的操作记录
  - 显示前后对比（可选）
- [ ] 导出功能
  - 导出为 CSV

**验收标准**:
- 可以查看审计日志
- 筛选和搜索功能正常

---

### 推广任务（12 点）

#### 4. 大规模推广（12 点）
**负责人**: 产品经理
**任务**:
- [ ] 推广策划
  - 宣传文案
  - 海报设计
  - 视频演示
- [ ] 全员培训
  - 线上培训（3 场，每场 50 人）
  - 录制培训视频（可重复观看）
- [ ] 自助接入优化
  - 接入向导
  - 自动化检测（环境、权限）
  - 快速诊断工具
- [ ] 激励措施
  - 早期采用者奖励
  - 质量标兵奖励
- [ ] 案例包装
  - 编写成功案例（3 个）
  - 数据对比（接入前后）
  - 用户证言

**验收标准**:
- 新增 10 个项目接入（累计 20 个）
- 培训覆盖 150+ 人
- 案例包装完成

---

### Sprint 8 验收标准（DoD）
- ✅ 权限系统完善
- ✅ 20 个项目接入
- ✅ 活跃用户 200+
- ✅ 用户满意度 > 4.1

---

## 阶段二总验收标准

### 功能验收
- ✅ 支持 5+ 编程语言（Go, Python, TypeScript, Java, C）
- ✅ 规则库包含 100+ 条规则
- ✅ GitHub Actions 和 Git Hook 工具上线
- ✅ 规则管理系统完整
- ✅ 技术债务管理可用
- ✅ 多维度分析（用户/部门/公司）
- ✅ 权限和多租户系统完善

### 质量验收
- ✅ 审查准确率 > 80%
- ✅ 误报率 < 15%
- ✅ 审查时长(P95) < 45s
- ✅ 系统可用性 > 99.5%

### 业务验收
- ✅ 20 个项目接入
- ✅ 200+ 活跃用户
- ✅ 日均审查次数 > 100
- ✅ 发现问题总数 > 1,000
- ✅ 用户满意度 > 4.1

---

## 风险和应对

### 高风险

| 风险 | 缓解措施 |
|------|---------|
| 规则库质量参差不齐 | AI 工程师专职优化，建立规则评审流程 |
| 权限系统复杂度高 | 简化权限模型，只实现核心场景 |
| 推广速度跟不上目标 | 提前预热，激励措施，简化接入流程 |
| 数据聚合性能问题 | 使用 Redis 缓存，异步聚合，优化查询 |

### 调整策略

如果第 12 周项目接入数 < 15：
- 暂停新功能开发
- 全员参与推广
- 分析接入阻碍因素
- 优化接入体验

---

## 附录

### 关键指标追踪（每周）

| 周 | 接入项目数 | 活跃用户数 | 审查次数 | 准确率 | NPS |
|----|-----------|-----------|---------|--------|-----|
| 9  | 13        | 100       | 50      | 80%    | 4.0 |
| 10 | 15        | 120       | 60      | 81%    | 4.0 |
| 11 | 16        | 130       | 70      | 82%    | 4.1 |
| 12 | 18        | 150       | 80      | 82%    | 4.1 |
| 13 | 19        | 170       | 90      | 83%    | 4.1 |
| 14 | 20        | 180       | 95      | 83%    | 4.1 |
| 15 | 22        | 190       | 100     | 84%    | 4.1 |
| 16 | 25        | 210       | 110     | 84%    | 4.2 |

### 每两周 Demo Day

展示新功能，收集反馈：
- 第 10 周：GitHub Actions + CLI 工具
- 第 12 周：规则管理系统
- 第 14 周：技术债务和多维度分析
- 第 16 周：权限系统和阶段总结
